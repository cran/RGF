<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Lampros Mouselimis" />

<meta name="date" content="2021-05-07" />

<title>Regularized Greedy Forest in R</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Regularized Greedy Forest in R</h1>
<h4 class="author">Lampros Mouselimis</h4>
<h4 class="date">2021-05-07</h4>



<p>The RGF package is a wrapper of the <a href="https://github.com/RGF-team/rgf/tree/master/python-package"><em>Regularized Greedy Forest</em></a> <em>python</em> package, which also includes a <a href="https://github.com/RGF-team/rgf/tree/master/FastRGF"><em>Multi-core implementation (FastRGF)</em></a>. Portability from Python to R was made possible using the <a href="https://github.com/rstudio/reticulate">reticulate</a> package and the installation requires basic knowledge of Python. Except for the Linux Operating System, the installation on Macintosh and Windows might be somehow cumbersome (on windows the package currently can be used only from within the command prompt). Detailed installation instructions for all three Operating Systems can be found in the <em>README.md</em> file and in the <a href="https://github.com/RGF-team/rgf/tree/master/python-package"><em>rgf_python</em></a> GitHub repository.</p>
<p><br></p>
<p>The <em>Regularized Greedy Forest</em> algorithm is explained in detail in the paper <a href="https://arxiv.org/abs/1109.0887"><em>Rie Johnson and Tong Zhang, Learning Nonlinear Functions Using Regularized Greedy Forest</em></a>. A small synopsis would be <em>“… the resulting method, which we refer to as regularized greedy forest (RGF), integrates two ideas: one is to include tree-structured regularization into the learning formulation; and the other is to employ the fully-corrective regularized greedy algorithm ….”</em>.</p>
<p><br></p>
<p>At the time of writing this Vignette (11 - 02 - 2018), there isn’t a corresponding implementation of the algorithm in the R language, so I decided to port the Python package in R taking advantage of the reticulate package. In the next lines, I will explain the functionality of the package and I compare RGF with other similar implementations, such as <a href="https://github.com/imbs-hl/ranger"><em>ranger</em></a> (random forest algorithm) and <a href="https://github.com/dmlc/xgboost/tree/master/R-package"><em>xgboost</em></a> (gradient boosting algorithm), in terms of time efficiency and error rate improvement.</p>
<p><br></p>
<div id="the-rgf-package" class="section level4">
<h4>The RGF package</h4>
<p><br></p>
<p>The <em>RGF</em> package includes the following R6-classes / functions,</p>
<p><br></p>
<div id="classes" class="section level5">
<h5><strong>classes</strong></h5>
<p><br></p>
<table>
<thead>
<tr class="header">
<th align="center">RGF_Regressor</th>
<th align="center">RGF_Classifier</th>
<th align="center">FastRGF_Regressor</th>
<th align="center">FastRGF_Classifier</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">fit()</td>
<td align="center">fit()</td>
<td align="center">fit()</td>
<td align="center">fit()</td>
</tr>
<tr class="even">
<td align="center">predict()</td>
<td align="center">predict()</td>
<td align="center">predict()</td>
<td align="center">predict()</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center">predict_proba()</td>
<td align="center"></td>
<td align="center">predict_proba()</td>
</tr>
<tr class="even">
<td align="center">cleanup()</td>
<td align="center">cleanup()</td>
<td align="center">cleanup()</td>
<td align="center">cleanup()</td>
</tr>
<tr class="odd">
<td align="center">get_params()</td>
<td align="center">get_params()</td>
<td align="center">get_params()</td>
<td align="center">get_params()</td>
</tr>
<tr class="even">
<td align="center">score()</td>
<td align="center">score()</td>
<td align="center">score()</td>
<td align="center">score()</td>
</tr>
<tr class="odd">
<td align="center">feature_importances()</td>
<td align="center">feature_importances()</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center">dump_model()</td>
<td align="center">dump_model()</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="functions" class="section level5">
<h5><strong>functions</strong></h5>
<p><strong>UPDATE 10-05-2018</strong> : Beginning from version <strong>1.0.3</strong> the <strong>dgCMatrix_2scipy_sparse</strong> function was renamed to <strong>TO_scipy_sparse</strong> and now accepts either a <em>dgCMatrix</em> or a <em>dgRMatrix</em> as input. The appropriate format for the RGF package in case of sparse matrices is the <strong>dgCMatrix</strong> format (<em>scipy.sparse.csc_matrix</em>)</p>
<p><br></p>
<table>
<thead>
<tr class="header">
<th align="left">TO_scipy_sparse()</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="left">RGF_cleanup_temp_files()</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="left">mat_2scipy_sparse()</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p><br></p>
<p>The package documentation includes details and examples for all R6-classes and functions. In the following code chunks, I’ll explain how a user can work with sparse matrices as all RGF algorithms (besides a dense matrix) <strong>require a python sparse matrix as input</strong>.</p>
<p><br></p>
</div>
</div>
<div id="sparse-matrices-as-input" class="section level4">
<h4>Sparse matrices as input</h4>
<p><br></p>
<p>The RGF package includes two functions (<strong>mat_2scipy_sparse</strong> and <strong>TO_scipy_sparse</strong>) which allow the user to convert from a <em>matrix</em> / <em>sparse matrix</em> (<em>dgCMatrix</em>, <em>dgRMatrix</em>) to a <em>scipy sparse matrix</em> (<em>scipy.sparse.csc_matrix</em>, <em>scipy.sparse.csr_matrix</em>),</p>
<p><br></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(RGF)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># conversion from a matrix object to a scipy sparse matrix</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#----------------------------------------------------------</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>x =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">1000</span>), <span class="dt">nrow =</span> <span class="dv">100</span>, <span class="dt">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>x_sparse =<span class="st"> </span><span class="kw">mat_2scipy_sparse</span>(x, <span class="dt">format =</span> <span class="st">&quot;sparse_row_matrix&quot;</span>)</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="kw">print</span>(<span class="kw">dim</span>(x))</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a>[<span class="dv">1</span>] <span class="dv">100</span>  <span class="dv">10</span></span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="kw">print</span>(x_sparse<span class="op">$</span>shape)</span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a>(<span class="dv">100</span>, <span class="dv">10</span>)</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># conversion from a dgCMatrix object to a scipy sparse matrix</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#-------------------------------------------------------------</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>data =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># &#39;dgCMatrix&#39; sparse matrix</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#--------------------------</span></span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a>dgcM =<span class="st"> </span>Matrix<span class="op">::</span><span class="kw">Matrix</span>(<span class="dt">data =</span> data, <span class="dt">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a>                      <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>,</span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a>                      <span class="dt">sparse =</span> <span class="ot">TRUE</span>)</span>
<span id="cb2-15"><a href="#cb2-15"></a></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="kw">print</span>(<span class="kw">dim</span>(dgcM))</span>
<span id="cb2-17"><a href="#cb2-17"></a></span>
<span id="cb2-18"><a href="#cb2-18"></a>[<span class="dv">1</span>] <span class="dv">3</span> <span class="dv">3</span></span>
<span id="cb2-19"><a href="#cb2-19"></a></span>
<span id="cb2-20"><a href="#cb2-20"></a>x_sparse =<span class="st"> </span><span class="kw">TO_scipy_sparse</span>(dgcM)</span>
<span id="cb2-21"><a href="#cb2-21"></a></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="kw">print</span>(x_sparse<span class="op">$</span>shape)</span>
<span id="cb2-23"><a href="#cb2-23"></a></span>
<span id="cb2-24"><a href="#cb2-24"></a>(<span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb2-25"><a href="#cb2-25"></a></span>
<span id="cb2-26"><a href="#cb2-26"></a></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co"># &#39;dgRMatrix&#39; sparse matrix</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">#--------------------------</span></span>
<span id="cb2-29"><a href="#cb2-29"></a></span>
<span id="cb2-30"><a href="#cb2-30"></a>dgrM =<span class="st"> </span><span class="kw">as</span>(dgcM, <span class="st">&quot;RsparseMatrix&quot;</span>)</span>
<span id="cb2-31"><a href="#cb2-31"></a></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="kw">class</span>(dgrM)</span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co"># [1] &quot;dgRMatrix&quot;</span></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co"># attr(,&quot;package&quot;)</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co"># [1] &quot;Matrix&quot;</span></span>
<span id="cb2-37"><a href="#cb2-37"></a></span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="kw">print</span>(<span class="kw">dim</span>(dgrM))</span>
<span id="cb2-39"><a href="#cb2-39"></a></span>
<span id="cb2-40"><a href="#cb2-40"></a>[<span class="dv">1</span>] <span class="dv">3</span> <span class="dv">3</span></span>
<span id="cb2-41"><a href="#cb2-41"></a></span>
<span id="cb2-42"><a href="#cb2-42"></a>res_dgr =<span class="st"> </span><span class="kw">TO_scipy_sparse</span>(dgrM)</span>
<span id="cb2-43"><a href="#cb2-43"></a></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="kw">print</span>(res_dgr<span class="op">$</span>shape)</span>
<span id="cb2-45"><a href="#cb2-45"></a></span>
<span id="cb2-46"><a href="#cb2-46"></a>(<span class="dv">3</span>, <span class="dv">3</span>)</span></code></pre></div>
<p><br></p>
</div>
<div id="comparison-of-rgf-with-ranger-and-xgboost" class="section level4">
<h4>Comparison of RGF with ranger and xgboost</h4>
<p><br></p>
<p>First the data, libraries and cross-validation function will be inputted (the <em>MLmetrics</em> library is also required),</p>
<p><br></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">data</span>(Boston, <span class="dt">package =</span> <span class="st">&#39;KernelKnn&#39;</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">library</span>(RGF)</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw">library</span>(ranger)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">library</span>(xgboost)</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co"># shuffling function for cross-validation folds</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#-----------------------------------------------</span></span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a>func_shuffle =<span class="st"> </span><span class="cf">function</span>(vec, <span class="dt">times =</span> <span class="dv">10</span>) {</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>times) {</span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a>    out =<span class="st"> </span><span class="kw">sample</span>(vec, <span class="kw">length</span>(vec))</span>
<span id="cb3-18"><a href="#cb3-18"></a>  }</span>
<span id="cb3-19"><a href="#cb3-19"></a>  out</span>
<span id="cb3-20"><a href="#cb3-20"></a>}</span>
<span id="cb3-21"><a href="#cb3-21"></a></span>
<span id="cb3-22"><a href="#cb3-22"></a></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co"># cross-validation folds [ regression]</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">#-------------------------------------</span></span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a></span>
<span id="cb3-27"><a href="#cb3-27"></a>regr_folds =<span class="st"> </span><span class="cf">function</span>(folds, RESP, <span class="dt">stratified =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb3-28"><a href="#cb3-28"></a></span>
<span id="cb3-29"><a href="#cb3-29"></a>  <span class="cf">if</span> (<span class="kw">is.factor</span>(RESP)) {</span>
<span id="cb3-30"><a href="#cb3-30"></a></span>
<span id="cb3-31"><a href="#cb3-31"></a>    <span class="kw">stop</span>(<span class="kw">simpleError</span>(<span class="st">&quot;This function is meant for regression. </span></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="st">                     For classification use the &#39;class_folds&#39; function.&quot;</span>))</span>
<span id="cb3-33"><a href="#cb3-33"></a>  }</span>
<span id="cb3-34"><a href="#cb3-34"></a></span>
<span id="cb3-35"><a href="#cb3-35"></a>  samp_vec =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span>folds, folds)</span>
<span id="cb3-36"><a href="#cb3-36"></a></span>
<span id="cb3-37"><a href="#cb3-37"></a>  sort_names =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;fold_&#39;</span>, <span class="dv">1</span><span class="op">:</span>folds)</span>
<span id="cb3-38"><a href="#cb3-38"></a></span>
<span id="cb3-39"><a href="#cb3-39"></a></span>
<span id="cb3-40"><a href="#cb3-40"></a>  <span class="cf">if</span> (stratified <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {</span>
<span id="cb3-41"><a href="#cb3-41"></a></span>
<span id="cb3-42"><a href="#cb3-42"></a>    stratif =<span class="st"> </span><span class="kw">cut</span>(RESP, <span class="dt">breaks =</span> folds)</span>
<span id="cb3-43"><a href="#cb3-43"></a></span>
<span id="cb3-44"><a href="#cb3-44"></a>    clas =<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">unique</span>(stratif), <span class="cf">function</span>(x) <span class="kw">which</span>(stratif <span class="op">==</span><span class="st"> </span>x))</span>
<span id="cb3-45"><a href="#cb3-45"></a></span>
<span id="cb3-46"><a href="#cb3-46"></a>    len =<span class="st"> </span><span class="kw">lapply</span>(clas, <span class="cf">function</span>(x) <span class="kw">length</span>(x))</span>
<span id="cb3-47"><a href="#cb3-47"></a></span>
<span id="cb3-48"><a href="#cb3-48"></a>    prop =<span class="st"> </span><span class="kw">lapply</span>(len, <span class="cf">function</span>(y) <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(samp_vec), <span class="cf">function</span>(x) </span>
<span id="cb3-49"><a href="#cb3-49"></a>      <span class="kw">round</span>(y <span class="op">*</span><span class="st"> </span>samp_vec[x])))</span>
<span id="cb3-50"><a href="#cb3-50"></a></span>
<span id="cb3-51"><a href="#cb3-51"></a>    repl =<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(prop, <span class="cf">function</span>(x) <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x), <span class="cf">function</span>(y) </span>
<span id="cb3-52"><a href="#cb3-52"></a>      <span class="kw">rep</span>(<span class="kw">paste0</span>(<span class="st">&#39;fold_&#39;</span>, y), x[y]))))</span>
<span id="cb3-53"><a href="#cb3-53"></a></span>
<span id="cb3-54"><a href="#cb3-54"></a>    spl =<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">split</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(RESP), repl))}</span>
<span id="cb3-55"><a href="#cb3-55"></a></span>
<span id="cb3-56"><a href="#cb3-56"></a>  <span class="cf">else</span> {</span>
<span id="cb3-57"><a href="#cb3-57"></a></span>
<span id="cb3-58"><a href="#cb3-58"></a>    prop =<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">length</span>(RESP), <span class="cf">function</span>(y) <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(samp_vec), </span>
<span id="cb3-59"><a href="#cb3-59"></a>                                                   <span class="cf">function</span>(x) <span class="kw">round</span>(y <span class="op">*</span><span class="st"> </span>samp_vec[x])))</span>
<span id="cb3-60"><a href="#cb3-60"></a></span>
<span id="cb3-61"><a href="#cb3-61"></a>    repl =<span class="st"> </span><span class="kw">func_shuffle</span>(<span class="kw">unlist</span>(<span class="kw">lapply</span>(prop, <span class="cf">function</span>(x) </span>
<span id="cb3-62"><a href="#cb3-62"></a>      <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x), <span class="cf">function</span>(y) <span class="kw">rep</span>(<span class="kw">paste0</span>(<span class="st">&#39;fold_&#39;</span>, y), x[y])))))</span>
<span id="cb3-63"><a href="#cb3-63"></a></span>
<span id="cb3-64"><a href="#cb3-64"></a>    spl =<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">split</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(RESP), repl))</span>
<span id="cb3-65"><a href="#cb3-65"></a>  }</span>
<span id="cb3-66"><a href="#cb3-66"></a></span>
<span id="cb3-67"><a href="#cb3-67"></a>  spl =<span class="st"> </span>spl[sort_names]</span>
<span id="cb3-68"><a href="#cb3-68"></a></span>
<span id="cb3-69"><a href="#cb3-69"></a>  <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">table</span>(<span class="kw">unlist</span>(<span class="kw">lapply</span>(spl, <span class="cf">function</span>(x) <span class="kw">length</span>(x))))) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb3-70"><a href="#cb3-70"></a></span>
<span id="cb3-71"><a href="#cb3-71"></a>    <span class="kw">warning</span>(<span class="st">&#39;the folds are not equally split&#39;</span>)</span>
<span id="cb3-72"><a href="#cb3-72"></a>  }</span>
<span id="cb3-73"><a href="#cb3-73"></a></span>
<span id="cb3-74"><a href="#cb3-74"></a>  <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">unlist</span>(spl)) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(RESP)) {</span>
<span id="cb3-75"><a href="#cb3-75"></a></span>
<span id="cb3-76"><a href="#cb3-76"></a>    <span class="kw">stop</span>(<span class="kw">simpleError</span>(<span class="st">&quot;the length of the splits are not equal with the length </span></span>
<span id="cb3-77"><a href="#cb3-77"></a><span class="st">                     of the response&quot;</span>))</span>
<span id="cb3-78"><a href="#cb3-78"></a>  }</span>
<span id="cb3-79"><a href="#cb3-79"></a></span>
<span id="cb3-80"><a href="#cb3-80"></a>  spl</span>
<span id="cb3-81"><a href="#cb3-81"></a>}</span></code></pre></div>
<p><br></p>
<table>
<thead>
<tr class="header">
<th>single threaded [ small data set ]</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p><br></p>
<p>In the next code chunk, I’ll perform 5-fold cross-validation using the Boston dataset and I’ll compare time execution and error rate for all three algorithms (<strong>without doing hyper-parameter tuning</strong>),</p>
<p><br></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>NUM_FOLDS =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>FOLDS =<span class="st"> </span><span class="kw">regr_folds</span>(<span class="dt">folds =</span> NUM_FOLDS, Boston[, <span class="st">&#39;medv&#39;</span>], <span class="dt">stratified =</span> T)</span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a>boston_rgf_te =<span class="st"> </span>boston_ranger_te =<span class="st"> </span>boston_xgb_te =<span class="st"> </span>boston_rgf_time =<span class="st"> </span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="st">  </span>boston_ranger_time =<span class="st"> </span>boston_xgb_time =<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, NUM_FOLDS)</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(FOLDS)) {</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="kw">cat</span>(<span class="st">&quot;fold : &quot;</span>, i, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-14"><a href="#cb4-14"></a></span>
<span id="cb4-15"><a href="#cb4-15"></a>  samp =<span class="st"> </span><span class="kw">unlist</span>(FOLDS[<span class="op">-</span>i])</span>
<span id="cb4-16"><a href="#cb4-16"></a>  samp_ =<span class="st"> </span><span class="kw">unlist</span>(FOLDS[i])</span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a></span>
<span id="cb4-19"><a href="#cb4-19"></a>  <span class="co"># RGF</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>  <span class="co">#----</span></span>
<span id="cb4-21"><a href="#cb4-21"></a></span>
<span id="cb4-22"><a href="#cb4-22"></a>  rgf_start =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb4-23"><a href="#cb4-23"></a></span>
<span id="cb4-24"><a href="#cb4-24"></a>  init_regr =<span class="st"> </span>RGF_Regressor<span class="op">$</span><span class="kw">new</span>(<span class="dt">l2 =</span> <span class="fl">0.1</span>)</span>
<span id="cb4-25"><a href="#cb4-25"></a></span>
<span id="cb4-26"><a href="#cb4-26"></a>  init_regr<span class="op">$</span><span class="kw">fit</span>(<span class="dt">x =</span> <span class="kw">as.matrix</span>(Boston[samp, <span class="op">-</span><span class="kw">ncol</span>(Boston)]), <span class="dt">y =</span> Boston[samp, <span class="kw">ncol</span>(Boston)])</span>
<span id="cb4-27"><a href="#cb4-27"></a></span>
<span id="cb4-28"><a href="#cb4-28"></a>  pr_te =<span class="st"> </span>init_regr<span class="op">$</span><span class="kw">predict</span>(<span class="kw">as.matrix</span>(Boston[samp_, <span class="op">-</span><span class="kw">ncol</span>(Boston)]))</span>
<span id="cb4-29"><a href="#cb4-29"></a></span>
<span id="cb4-30"><a href="#cb4-30"></a>  rgf_end =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb4-31"><a href="#cb4-31"></a></span>
<span id="cb4-32"><a href="#cb4-32"></a>  boston_rgf_time[i] =<span class="st"> </span>rgf_end <span class="op">-</span><span class="st"> </span>rgf_start</span>
<span id="cb4-33"><a href="#cb4-33"></a></span>
<span id="cb4-34"><a href="#cb4-34"></a>  boston_rgf_te[i] =<span class="st"> </span>MLmetrics<span class="op">::</span><span class="kw">RMSE</span>(Boston[samp_, <span class="st">&#39;medv&#39;</span>], pr_te)</span>
<span id="cb4-35"><a href="#cb4-35"></a></span>
<span id="cb4-36"><a href="#cb4-36"></a></span>
<span id="cb4-37"><a href="#cb4-37"></a>  <span class="co"># ranger</span></span>
<span id="cb4-38"><a href="#cb4-38"></a>  <span class="co">#-------</span></span>
<span id="cb4-39"><a href="#cb4-39"></a></span>
<span id="cb4-40"><a href="#cb4-40"></a>  ranger_start =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb4-41"><a href="#cb4-41"></a></span>
<span id="cb4-42"><a href="#cb4-42"></a>  fit =<span class="st"> </span><span class="kw">ranger</span>(<span class="dt">dependent.variable.name =</span> <span class="st">&quot;medv&quot;</span>, <span class="dt">data =</span> Boston[samp, ], <span class="dt">write.forest =</span> <span class="ot">TRUE</span>, </span>
<span id="cb4-43"><a href="#cb4-43"></a>               </span>
<span id="cb4-44"><a href="#cb4-44"></a>               <span class="dt">probability =</span> F, <span class="dt">num.threads =</span> <span class="dv">1</span>, <span class="dt">num.trees =</span> <span class="dv">500</span>, <span class="dt">verbose =</span> T, </span>
<span id="cb4-45"><a href="#cb4-45"></a>               </span>
<span id="cb4-46"><a href="#cb4-46"></a>               <span class="dt">classification =</span> F, <span class="dt">mtry =</span> <span class="ot">NULL</span>, <span class="dt">min.node.size =</span> <span class="dv">5</span>, <span class="dt">keep.inbag =</span> T)</span>
<span id="cb4-47"><a href="#cb4-47"></a></span>
<span id="cb4-48"><a href="#cb4-48"></a>  pred_te =<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">data =</span> Boston[samp_, <span class="op">-</span><span class="kw">ncol</span>(Boston)], <span class="dt">type =</span> <span class="st">&#39;se&#39;</span>)<span class="op">$</span>predictions</span>
<span id="cb4-49"><a href="#cb4-49"></a></span>
<span id="cb4-50"><a href="#cb4-50"></a>  ranger_end =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb4-51"><a href="#cb4-51"></a></span>
<span id="cb4-52"><a href="#cb4-52"></a>  boston_ranger_time[i] =<span class="st"> </span>ranger_end <span class="op">-</span><span class="st"> </span>ranger_start</span>
<span id="cb4-53"><a href="#cb4-53"></a></span>
<span id="cb4-54"><a href="#cb4-54"></a>  boston_ranger_te[i] =<span class="st"> </span>MLmetrics<span class="op">::</span><span class="kw">RMSE</span>(Boston[samp_, <span class="st">&#39;medv&#39;</span>], pred_te)</span>
<span id="cb4-55"><a href="#cb4-55"></a></span>
<span id="cb4-56"><a href="#cb4-56"></a></span>
<span id="cb4-57"><a href="#cb4-57"></a>  <span class="co"># xgboost</span></span>
<span id="cb4-58"><a href="#cb4-58"></a>  <span class="co">#--------</span></span>
<span id="cb4-59"><a href="#cb4-59"></a></span>
<span id="cb4-60"><a href="#cb4-60"></a>  xgb_start =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb4-61"><a href="#cb4-61"></a></span>
<span id="cb4-62"><a href="#cb4-62"></a>  dtrain &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(Boston[samp, <span class="op">-</span><span class="kw">ncol</span>(Boston)]), </span>
<span id="cb4-63"><a href="#cb4-63"></a>                        </span>
<span id="cb4-64"><a href="#cb4-64"></a>                        <span class="dt">label =</span> Boston[samp, <span class="kw">ncol</span>(Boston)])</span>
<span id="cb4-65"><a href="#cb4-65"></a></span>
<span id="cb4-66"><a href="#cb4-66"></a>  dtest &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(Boston[samp_, <span class="op">-</span><span class="kw">ncol</span>(Boston)]), </span>
<span id="cb4-67"><a href="#cb4-67"></a>                       </span>
<span id="cb4-68"><a href="#cb4-68"></a>                       <span class="dt">label =</span> Boston[samp_, <span class="kw">ncol</span>(Boston)])</span>
<span id="cb4-69"><a href="#cb4-69"></a></span>
<span id="cb4-70"><a href="#cb4-70"></a>  </span>
<span id="cb4-71"><a href="#cb4-71"></a>  watchlist &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">train =</span> dtrain, <span class="dt">test =</span> dtest)</span>
<span id="cb4-72"><a href="#cb4-72"></a></span>
<span id="cb4-73"><a href="#cb4-73"></a>  </span>
<span id="cb4-74"><a href="#cb4-74"></a>  param =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;objective&quot;</span> =<span class="st"> &quot;reg:linear&quot;</span>, <span class="st">&quot;bst:eta&quot;</span> =<span class="st"> </span><span class="fl">0.05</span>, <span class="st">&quot;max_depth&quot;</span> =<span class="st"> </span><span class="dv">4</span>, </span>
<span id="cb4-75"><a href="#cb4-75"></a>               </span>
<span id="cb4-76"><a href="#cb4-76"></a>               <span class="st">&quot;subsample&quot;</span> =<span class="st"> </span><span class="fl">0.85</span>, <span class="st">&quot;colsample_bytree&quot;</span> =<span class="st"> </span><span class="fl">0.85</span>, <span class="st">&quot;booster&quot;</span> =<span class="st"> &quot;gbtree&quot;</span>,</span>
<span id="cb4-77"><a href="#cb4-77"></a>               </span>
<span id="cb4-78"><a href="#cb4-78"></a>               <span class="st">&quot;nthread&quot;</span> =<span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb4-79"><a href="#cb4-79"></a></span>
<span id="cb4-80"><a href="#cb4-80"></a>  fit =<span class="st"> </span><span class="kw">xgb.train</span>(param, dtrain, <span class="dt">nround =</span> <span class="dv">500</span>, <span class="dt">print_every_n  =</span> <span class="dv">100</span>, <span class="dt">watchlist =</span> watchlist,</span>
<span id="cb4-81"><a href="#cb4-81"></a></span>
<span id="cb4-82"><a href="#cb4-82"></a>                  <span class="dt">early_stopping_rounds =</span> <span class="dv">20</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb4-83"><a href="#cb4-83"></a></span>
<span id="cb4-84"><a href="#cb4-84"></a>  p_te =<span class="st"> </span>xgboost<span class="op">:::</span><span class="kw">predict.xgb.Booster</span>(fit, <span class="kw">as.matrix</span>(Boston[samp_, <span class="op">-</span><span class="kw">ncol</span>(Boston)]), </span>
<span id="cb4-85"><a href="#cb4-85"></a>                                       </span>
<span id="cb4-86"><a href="#cb4-86"></a>                                       <span class="dt">ntreelimit =</span> fit<span class="op">$</span>best_iteration)</span>
<span id="cb4-87"><a href="#cb4-87"></a></span>
<span id="cb4-88"><a href="#cb4-88"></a>  xgb_end =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb4-89"><a href="#cb4-89"></a></span>
<span id="cb4-90"><a href="#cb4-90"></a>  boston_xgb_time[i] =<span class="st"> </span>xgb_end <span class="op">-</span><span class="st"> </span>xgb_start</span>
<span id="cb4-91"><a href="#cb4-91"></a></span>
<span id="cb4-92"><a href="#cb4-92"></a>  boston_xgb_te[i] =<span class="st"> </span>MLmetrics<span class="op">::</span><span class="kw">RMSE</span>(Boston[samp_, <span class="st">&#39;medv&#39;</span>], p_te)</span>
<span id="cb4-93"><a href="#cb4-93"></a>}</span>
<span id="cb4-94"><a href="#cb4-94"></a></span>
<span id="cb4-95"><a href="#cb4-95"></a></span>
<span id="cb4-96"><a href="#cb4-96"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">1</span> </span>
<span id="cb4-97"><a href="#cb4-97"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">2</span> </span>
<span id="cb4-98"><a href="#cb4-98"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">3</span> </span>
<span id="cb4-99"><a href="#cb4-99"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">4</span> </span>
<span id="cb4-100"><a href="#cb4-100"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">5</span> </span>
<span id="cb4-101"><a href="#cb4-101"></a></span>
<span id="cb4-102"><a href="#cb4-102"></a></span>
<span id="cb4-103"><a href="#cb4-103"></a></span>
<span id="cb4-104"><a href="#cb4-104"></a><span class="kw">cat</span>(<span class="st">&quot;total time rgf 5 fold cross-validation : &quot;</span>, <span class="kw">sum</span>(boston_rgf_time), </span>
<span id="cb4-105"><a href="#cb4-105"></a>    <span class="st">&quot; mean rmse on test data : &quot;</span>, <span class="kw">mean</span>(boston_rgf_te), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-106"><a href="#cb4-106"></a></span>
<span id="cb4-107"><a href="#cb4-107"></a><span class="kw">cat</span>(<span class="st">&quot;total time ranger 5 fold cross-validation : &quot;</span>, <span class="kw">sum</span>(boston_ranger_time), </span>
<span id="cb4-108"><a href="#cb4-108"></a>    <span class="st">&quot; mean rmse on test data : &quot;</span>, <span class="kw">mean</span>(boston_ranger_te), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-109"><a href="#cb4-109"></a></span>
<span id="cb4-110"><a href="#cb4-110"></a><span class="kw">cat</span>(<span class="st">&quot;total time xgb 5 fold cross-validation : &quot;</span>, <span class="kw">sum</span>(boston_xgb_time),</span>
<span id="cb4-111"><a href="#cb4-111"></a>    <span class="st">&quot; mean rmse on test data : &quot;</span>, <span class="kw">mean</span>(boston_xgb_te), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>total time rgf <span class="dv">5</span> fold cross<span class="op">-</span>validation <span class="op">:</span><span class="st">  </span><span class="fl">0.7730639</span>  mean rmse on test data <span class="op">:</span><span class="st">  </span><span class="fl">3.832135</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>total time ranger <span class="dv">5</span> fold cross<span class="op">-</span>validation <span class="op">:</span><span class="st">  </span><span class="fl">3.826846</span>  mean rmse on test data <span class="op">:</span><span class="st">  </span><span class="fl">4.17419</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>total time xgb <span class="dv">5</span> fold cross<span class="op">-</span>validation <span class="op">:</span><span class="st">  </span><span class="fl">0.4316094</span>  mean rmse on test data <span class="op">:</span><span class="st">  </span><span class="fl">3.949122</span> </span></code></pre></div>
<p><br></p>
<table>
<colgroup>
<col width="100%"></col>
</colgroup>
<thead>
<tr class="header">
<th>5 threads [ high dimensional data set and presence of multicollinearity ]</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p><br></p>
<p>For the high-dimensional data (can be downloaded from the following <a href="https://github.com/mlampros/DataSets">GitHub repository</a>) we’ll use the <em>FastRGF_Regressor</em> rather than the RGF_Regressor (comparison <strong>without doing hyper-parameter tuning</strong>),</p>
<p><br></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># download the data from the following GitHub repository (tested on a Linux OS)</span></span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">system</span>(<span class="st">&quot;wget </span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">       https://raw.githubusercontent.com/mlampros/DataSets/master/africa_soil_train_data.zip&quot;</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># load the data in the R session</span></span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a>train_dat =<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">unz</span>(<span class="st">&quot;africa_soil_train_data.zip&quot;</span>, <span class="st">&quot;train.csv&quot;</span>), <span class="dt">nrows =</span> <span class="dv">1157</span>, </span>
<span id="cb6-10"><a href="#cb6-10"></a>                       </span>
<span id="cb6-11"><a href="#cb6-11"></a>                       <span class="dt">header =</span> T, <span class="dt">quote =</span> <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb6-12"><a href="#cb6-12"></a></span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co"># c(&quot;Ca&quot;, &quot;P&quot;, &quot;pH&quot;, &quot;SOC&quot;, &quot;Sand&quot;) : response variables            </span></span>
<span id="cb6-15"><a href="#cb6-15"></a></span>
<span id="cb6-16"><a href="#cb6-16"></a></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co"># exclude response-variables and factor variable</span></span>
<span id="cb6-18"><a href="#cb6-18"></a></span>
<span id="cb6-19"><a href="#cb6-19"></a>x =<span class="st"> </span>train_dat[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">which</span>(<span class="kw">colnames</span>(train_dat) <span class="op">%in%</span><span class="st"> </span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="st">                              </span><span class="kw">c</span>(<span class="st">&quot;Ca&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;pH&quot;</span>, <span class="st">&quot;SOC&quot;</span>, <span class="st">&quot;Sand&quot;</span>, <span class="st">&quot;Depth&quot;</span>)))]</span>
<span id="cb6-21"><a href="#cb6-21"></a></span>
<span id="cb6-22"><a href="#cb6-22"></a></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co"># take (randomly) the first of the responses for train</span></span>
<span id="cb6-24"><a href="#cb6-24"></a></span>
<span id="cb6-25"><a href="#cb6-25"></a>y =<span class="st"> </span>train_dat[, <span class="st">&quot;Ca&quot;</span>]</span>
<span id="cb6-26"><a href="#cb6-26"></a></span>
<span id="cb6-27"><a href="#cb6-27"></a></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="co"># dataset for ranger</span></span>
<span id="cb6-29"><a href="#cb6-29"></a></span>
<span id="cb6-30"><a href="#cb6-30"></a>tmp_rg_dat =<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">Ca =</span> y, x)</span>
<span id="cb6-31"><a href="#cb6-31"></a></span>
<span id="cb6-32"><a href="#cb6-32"></a></span>
<span id="cb6-33"><a href="#cb6-33"></a><span class="co"># cross-validation folds</span></span>
<span id="cb6-34"><a href="#cb6-34"></a></span>
<span id="cb6-35"><a href="#cb6-35"></a><span class="kw">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb6-36"><a href="#cb6-36"></a>FOLDS =<span class="st"> </span><span class="kw">regr_folds</span>(<span class="dt">folds =</span> NUM_FOLDS, y, <span class="dt">stratified =</span> T)</span>
<span id="cb6-37"><a href="#cb6-37"></a></span>
<span id="cb6-38"><a href="#cb6-38"></a></span>
<span id="cb6-39"><a href="#cb6-39"></a>highdim_rgf_te =<span class="st"> </span>highdim_ranger_te =<span class="st"> </span>highdim_xgb_te =<span class="st"> </span>highdim_rgf_time =<span class="st"> </span></span>
<span id="cb6-40"><a href="#cb6-40"></a><span class="st">  </span>highdim_ranger_time =<span class="st"> </span>highdim_xgb_time =<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, NUM_FOLDS)</span>
<span id="cb6-41"><a href="#cb6-41"></a></span>
<span id="cb6-42"><a href="#cb6-42"></a></span>
<span id="cb6-43"><a href="#cb6-43"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(FOLDS)) {</span>
<span id="cb6-44"><a href="#cb6-44"></a></span>
<span id="cb6-45"><a href="#cb6-45"></a>  <span class="kw">cat</span>(<span class="st">&quot;fold : &quot;</span>, i, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-46"><a href="#cb6-46"></a></span>
<span id="cb6-47"><a href="#cb6-47"></a>  new_samp =<span class="st"> </span><span class="kw">unlist</span>(FOLDS[<span class="op">-</span>i])</span>
<span id="cb6-48"><a href="#cb6-48"></a>  new_samp_ =<span class="st"> </span><span class="kw">unlist</span>(FOLDS[i])</span>
<span id="cb6-49"><a href="#cb6-49"></a></span>
<span id="cb6-50"><a href="#cb6-50"></a></span>
<span id="cb6-51"><a href="#cb6-51"></a>  <span class="co"># RGF</span></span>
<span id="cb6-52"><a href="#cb6-52"></a>  <span class="co">#----</span></span>
<span id="cb6-53"><a href="#cb6-53"></a></span>
<span id="cb6-54"><a href="#cb6-54"></a>  rgf_start =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb6-55"><a href="#cb6-55"></a></span>
<span id="cb6-56"><a href="#cb6-56"></a>  init_regr =<span class="st"> </span>FastRGF_Regressor<span class="op">$</span><span class="kw">new</span>(<span class="dt">n_jobs =</span> <span class="dv">5</span>, <span class="dt">l2 =</span> <span class="fl">0.1</span>)       <span class="co"># added &#39;l2&#39; regularization</span></span>
<span id="cb6-57"><a href="#cb6-57"></a></span>
<span id="cb6-58"><a href="#cb6-58"></a>  init_regr<span class="op">$</span><span class="kw">fit</span>(<span class="dt">x =</span> <span class="kw">as.matrix</span>(x[new_samp, ]), <span class="dt">y =</span> y[new_samp])</span>
<span id="cb6-59"><a href="#cb6-59"></a></span>
<span id="cb6-60"><a href="#cb6-60"></a>  pr_te =<span class="st"> </span>init_regr<span class="op">$</span><span class="kw">predict</span>(<span class="kw">as.matrix</span>(x[new_samp_, ]))</span>
<span id="cb6-61"><a href="#cb6-61"></a></span>
<span id="cb6-62"><a href="#cb6-62"></a>  rgf_end =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb6-63"><a href="#cb6-63"></a></span>
<span id="cb6-64"><a href="#cb6-64"></a>  highdim_rgf_time[i] =<span class="st"> </span>rgf_end <span class="op">-</span><span class="st"> </span>rgf_start</span>
<span id="cb6-65"><a href="#cb6-65"></a></span>
<span id="cb6-66"><a href="#cb6-66"></a>  highdim_rgf_te[i] =<span class="st"> </span>MLmetrics<span class="op">::</span><span class="kw">RMSE</span>(y[new_samp_], pr_te)</span>
<span id="cb6-67"><a href="#cb6-67"></a></span>
<span id="cb6-68"><a href="#cb6-68"></a></span>
<span id="cb6-69"><a href="#cb6-69"></a>  <span class="co"># ranger</span></span>
<span id="cb6-70"><a href="#cb6-70"></a>  <span class="co">#-------</span></span>
<span id="cb6-71"><a href="#cb6-71"></a></span>
<span id="cb6-72"><a href="#cb6-72"></a>  ranger_start =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb6-73"><a href="#cb6-73"></a>  </span>
<span id="cb6-74"><a href="#cb6-74"></a></span>
<span id="cb6-75"><a href="#cb6-75"></a>  fit =<span class="st"> </span><span class="kw">ranger</span>(<span class="dt">dependent.variable.name =</span> <span class="st">&quot;Ca&quot;</span>, <span class="dt">data =</span> tmp_rg_dat[new_samp, ], </span>
<span id="cb6-76"><a href="#cb6-76"></a>               </span>
<span id="cb6-77"><a href="#cb6-77"></a>               <span class="dt">write.forest =</span> <span class="ot">TRUE</span>, <span class="dt">probability =</span> F, <span class="dt">num.threads =</span> <span class="dv">5</span>, <span class="dt">num.trees =</span> <span class="dv">500</span>,</span>
<span id="cb6-78"><a href="#cb6-78"></a>               </span>
<span id="cb6-79"><a href="#cb6-79"></a>               <span class="dt">verbose =</span> T, <span class="dt">classification =</span> F, <span class="dt">mtry =</span> <span class="ot">NULL</span>, <span class="dt">min.node.size =</span> <span class="dv">5</span>, </span>
<span id="cb6-80"><a href="#cb6-80"></a>               </span>
<span id="cb6-81"><a href="#cb6-81"></a>               <span class="dt">keep.inbag =</span> T)</span>
<span id="cb6-82"><a href="#cb6-82"></a>  </span>
<span id="cb6-83"><a href="#cb6-83"></a></span>
<span id="cb6-84"><a href="#cb6-84"></a>  pred_te =<span class="st"> </span><span class="kw">predict</span>(fit, <span class="dt">data =</span> x[new_samp_, ], <span class="dt">type =</span> <span class="st">&#39;se&#39;</span>)<span class="op">$</span>predictions</span>
<span id="cb6-85"><a href="#cb6-85"></a></span>
<span id="cb6-86"><a href="#cb6-86"></a>  ranger_end =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb6-87"><a href="#cb6-87"></a></span>
<span id="cb6-88"><a href="#cb6-88"></a>  highdim_ranger_time[i] =<span class="st"> </span>ranger_end <span class="op">-</span><span class="st"> </span>ranger_start</span>
<span id="cb6-89"><a href="#cb6-89"></a></span>
<span id="cb6-90"><a href="#cb6-90"></a>  highdim_ranger_te[i] =<span class="st"> </span>MLmetrics<span class="op">::</span><span class="kw">RMSE</span>(y[new_samp_], pred_te)</span>
<span id="cb6-91"><a href="#cb6-91"></a></span>
<span id="cb6-92"><a href="#cb6-92"></a></span>
<span id="cb6-93"><a href="#cb6-93"></a>  <span class="co"># xgboost</span></span>
<span id="cb6-94"><a href="#cb6-94"></a>  <span class="co">#--------</span></span>
<span id="cb6-95"><a href="#cb6-95"></a></span>
<span id="cb6-96"><a href="#cb6-96"></a>  xgb_start =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb6-97"><a href="#cb6-97"></a></span>
<span id="cb6-98"><a href="#cb6-98"></a>  dtrain &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(x[new_samp, ]), <span class="dt">label =</span> y[new_samp])</span>
<span id="cb6-99"><a href="#cb6-99"></a></span>
<span id="cb6-100"><a href="#cb6-100"></a>  dtest &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(x[new_samp_, ]), <span class="dt">label =</span> y[new_samp_])</span>
<span id="cb6-101"><a href="#cb6-101"></a></span>
<span id="cb6-102"><a href="#cb6-102"></a>  watchlist &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">train =</span> dtrain, <span class="dt">test =</span> dtest)</span>
<span id="cb6-103"><a href="#cb6-103"></a></span>
<span id="cb6-104"><a href="#cb6-104"></a>  param =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;objective&quot;</span> =<span class="st"> &quot;reg:linear&quot;</span>, <span class="st">&quot;bst:eta&quot;</span> =<span class="st"> </span><span class="fl">0.05</span>, <span class="st">&quot;max_depth&quot;</span> =<span class="st"> </span><span class="dv">6</span>, </span>
<span id="cb6-105"><a href="#cb6-105"></a>               </span>
<span id="cb6-106"><a href="#cb6-106"></a>               <span class="st">&quot;subsample&quot;</span> =<span class="st"> </span><span class="fl">0.85</span>, <span class="st">&quot;colsample_bytree&quot;</span> =<span class="st"> </span><span class="fl">0.85</span>, <span class="st">&quot;booster&quot;</span> =<span class="st"> &quot;gbtree&quot;</span>,</span>
<span id="cb6-107"><a href="#cb6-107"></a>               </span>
<span id="cb6-108"><a href="#cb6-108"></a>               <span class="st">&quot;nthread&quot;</span> =<span class="st"> </span><span class="dv">5</span>)                        <span class="co"># &quot;lambda&quot; = 0.1 does not improve RMSE</span></span>
<span id="cb6-109"><a href="#cb6-109"></a></span>
<span id="cb6-110"><a href="#cb6-110"></a>  fit =<span class="st"> </span><span class="kw">xgb.train</span>(param, dtrain, <span class="dt">nround =</span> <span class="dv">500</span>, <span class="dt">print_every_n  =</span> <span class="dv">100</span>, <span class="dt">watchlist =</span> watchlist,</span>
<span id="cb6-111"><a href="#cb6-111"></a></span>
<span id="cb6-112"><a href="#cb6-112"></a>                  <span class="dt">early_stopping_rounds =</span> <span class="dv">20</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb6-113"><a href="#cb6-113"></a></span>
<span id="cb6-114"><a href="#cb6-114"></a>  p_te =<span class="st"> </span>xgboost<span class="op">:::</span><span class="kw">predict.xgb.Booster</span>(fit, <span class="kw">as.matrix</span>(x[new_samp_, ]), </span>
<span id="cb6-115"><a href="#cb6-115"></a>                                       <span class="dt">ntreelimit =</span> fit<span class="op">$</span>best_iteration)</span>
<span id="cb6-116"><a href="#cb6-116"></a></span>
<span id="cb6-117"><a href="#cb6-117"></a>  xgb_end =<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb6-118"><a href="#cb6-118"></a></span>
<span id="cb6-119"><a href="#cb6-119"></a>  highdim_xgb_time[i] =<span class="st"> </span>xgb_end <span class="op">-</span><span class="st"> </span>xgb_start</span>
<span id="cb6-120"><a href="#cb6-120"></a></span>
<span id="cb6-121"><a href="#cb6-121"></a>  highdim_xgb_te[i] =<span class="st"> </span>MLmetrics<span class="op">::</span><span class="kw">RMSE</span>(y[new_samp_], p_te)</span>
<span id="cb6-122"><a href="#cb6-122"></a>}</span>
<span id="cb6-123"><a href="#cb6-123"></a></span>
<span id="cb6-124"><a href="#cb6-124"></a></span>
<span id="cb6-125"><a href="#cb6-125"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">1</span> </span>
<span id="cb6-126"><a href="#cb6-126"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">2</span> </span>
<span id="cb6-127"><a href="#cb6-127"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">3</span> </span>
<span id="cb6-128"><a href="#cb6-128"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">4</span> </span>
<span id="cb6-129"><a href="#cb6-129"></a>fold <span class="op">:</span><span class="st">  </span><span class="dv">5</span> </span>
<span id="cb6-130"><a href="#cb6-130"></a></span>
<span id="cb6-131"><a href="#cb6-131"></a></span>
<span id="cb6-132"><a href="#cb6-132"></a><span class="kw">cat</span>(<span class="st">&quot;total time rgf 5 fold cross-validation : &quot;</span>, <span class="kw">sum</span>(highdim_rgf_time), </span>
<span id="cb6-133"><a href="#cb6-133"></a>    <span class="st">&quot; mean rmse on test data : &quot;</span>, <span class="kw">mean</span>(highdim_rgf_te), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-134"><a href="#cb6-134"></a></span>
<span id="cb6-135"><a href="#cb6-135"></a><span class="kw">cat</span>(<span class="st">&quot;total time ranger 5 fold cross-validation : &quot;</span>, <span class="kw">sum</span>(highdim_ranger_time), </span>
<span id="cb6-136"><a href="#cb6-136"></a>    <span class="st">&quot; mean rmse on test data : &quot;</span>, <span class="kw">mean</span>(highdim_ranger_te), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb6-137"><a href="#cb6-137"></a></span>
<span id="cb6-138"><a href="#cb6-138"></a><span class="kw">cat</span>(<span class="st">&quot;total time xgb 5 fold cross-validation : &quot;</span>, <span class="kw">sum</span>(highdim_xgb_time), </span>
<span id="cb6-139"><a href="#cb6-139"></a>    <span class="st">&quot; mean rmse on test data : &quot;</span>, <span class="kw">mean</span>(highdim_xgb_te), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>total time rgf <span class="dv">5</span> fold cross<span class="op">-</span>validation <span class="op">:</span><span class="st">  </span><span class="fl">92.31971</span>  mean rmse on test data <span class="op">:</span><span class="st">  </span><span class="fl">0.5155166</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>total time ranger <span class="dv">5</span> fold cross<span class="op">-</span>validation <span class="op">:</span><span class="st">  </span><span class="fl">27.32866</span>  mean rmse on test data <span class="op">:</span><span class="st">  </span><span class="fl">0.5394164</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>total time xgb <span class="dv">5</span> fold cross<span class="op">-</span>validation <span class="op">:</span><span class="st">  </span><span class="fl">30.48834</span>  mean rmse on test data <span class="op">:</span><span class="st">  </span><span class="fl">0.5453544</span></span></code></pre></div>
<p><br></p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
